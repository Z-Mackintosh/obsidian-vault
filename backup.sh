#!/bin/bash

# --- æ­¥éª¤ 1: æ¬¢è¿å¹¶è·å–æäº¤æ³¨é‡Š ---
# ä½¿ç”¨ gum style ç¾åŒ–æ ‡é¢˜
gum style --border normal --margin "1" --padding "1 2" --border-foreground 212 "ğŸ“ å¼€å§‹å¤‡ä»½æ‚¨çš„ç¬”è®°"

# ä½¿ç”¨ gum input è·å–ç”¨æˆ·è¾“å…¥çš„æ³¨é‡Šï¼Œå¹¶æä¾›ä¸€ä¸ªæ¸…æ™°çš„æç¤º
COMMIT_MSG=$(gum input --placeholder "æ‚¨ä»Šå¤©æ›´æ–°äº†ä»€ä¹ˆï¼Ÿ (ä¾‹å¦‚ï¼šæ•´ç†äº†å…³äºDockerçš„ç¬”è®°)")

# æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¾“å…¥äº†æ³¨é‡Šã€‚å¦‚æœæ²¡è¾“å…¥ï¼Œå°±é€€å‡ºã€‚
if [ -z "$COMMIT_MSG" ]; then
    gum style --bold --foreground="9" "å¿…é¡»è¾“å…¥æ³¨é‡Šæ‰èƒ½æäº¤ï¼æ“ä½œå·²å–æ¶ˆã€‚"
    exit 1
fi

# --- æ­¥éª¤ 2: æœ€ç»ˆç¡®è®¤ ---
# åœ¨æ‰§è¡Œå‘½ä»¤å‰ï¼Œç”¨ gum confirm è®©ç”¨æˆ·æœ€åç¡®è®¤ä¸€æ¬¡ã€‚
gum style --margin "1 0" "å°†è¦æäº¤æ³¨é‡Š: \"$COMMIT_MSG\""
gum confirm "ç¡®å®šè¦å¤‡ä»½æ‰€æœ‰å˜æ›´å—?" \
    --affirmative="âœ… æ˜¯çš„ï¼Œå¼€å§‹å¤‡ä»½" \
    --negative="âŒ ç­‰ä¸€ä¸‹"

# å¦‚æœç”¨æˆ·é€‰æ‹© "ä¸"ï¼Œåˆ™é€€å‡ºè„šæœ¬
if [ $? -ne 0 ]; then
    gum style --foreground 240 "æ“ä½œå·²å–æ¶ˆã€‚"
    exit 0
fi

# --- æ­¥éª¤ 3: æ‰§è¡Œ Git å‘½ä»¤å¹¶æ˜¾ç¤ºåŠ è½½åŠ¨ç”» ---
# ä½¿ç”¨ gum spin åœ¨æ‰§è¡Œ git å‘½ä»¤æ—¶æ˜¾ç¤ºä¸€ä¸ªå‹å¥½çš„åŠ è½½åŠ¨ç”»ã€‚
gum spin --spinner dot --title "æ­£åœ¨å¤‡ä»½åˆ°è¿œç«¯ä»“åº“..." -- \
  sh -c "git add . && git commit -m \"$COMMIT_MSG\" && git push"

# --- æ­¥éª¤ 4: æ˜¾ç¤ºæœ€ç»ˆç»“æœ ---
# æ ¹æ®ä¸Šä¸€æ­¥ git å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œç»™å‡ºæˆåŠŸæˆ–å¤±è´¥çš„æç¤ºã€‚
if [ $? -eq 0 ]; then
    gum style --foreground "10" --margin "1 0" "ğŸ‰ å¤‡ä»½æˆåŠŸï¼æ‚¨çš„ç¬”è®°å·²å®‰å…¨ä¸Šä¼ ã€‚"
else
    gum style --bold --foreground "9" --margin "1 0" "ğŸ”¥ å‡ºé”™äº†ï¼è¯·æ£€æŸ¥ä¸Šé¢çš„ Git è¾“å‡ºä¿¡æ¯ã€‚"
    exit 1
fi

